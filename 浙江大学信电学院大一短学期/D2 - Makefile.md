# <center>Makefile</center>  

#### 1. 基础应用  
```makefile
(Target): (obj1) (obj2)
    gcc (obj1) (obj2) -o (Target)

(obj1): (src1c) (src2h)
    gcc -c (src1c)
```  
概括为  
```
目标：依赖  （依赖关系）
    动作
```  
    
依赖关系下一行为空行或其他依赖关系时，编译器执行默认语句（cc命令），否则执行语句。  
#### 2. 高级用法
* **“通配”写法**
```makefile
%.o: %.c
    gcc -c $<
```  
* **内置变量与函数及其他写法**
```makefile
$@      依赖关系中的依赖项（冒号前的所有项）
$^      依赖关系中的所有被依赖项（冒号后的所有项）
$<      依赖关系中第一个被依赖项（冒号后的第一项）

@前缀   省略命令本身的显示，但保留结果的输出
echo    输出后面所跟的变量的值

行末\   表示下一行合并至本行
```
* **自定义变量**
```makefile
//定义
VARIABLE := ...
//使用
$(VARIABLE)
```  
* **主目标与伪目标**  
主目标：makefile中第一个目标，make命令默认执行此目标  
伪目标：实际上并不存在于文件目录中，但可以用来执行一些操作  
* **生成调试文件**  
    1. 使用-D参数  
    2. 调试代码单独置于一个文件，使用伪目标  
* **在命令行中修改代码**
1. 使用命令`make 变量名=... 伪目标`可实现对makefile变量的赋值  
2. 在.c文件中使用未定义的宏（如ARG），在makefile中使用`-D ARG='内容'`参数初始化宏  
* **makefile的自动依赖**
1. `-MMD`选项生成.d文件，自动分析文件间的依赖关系  
2. `DEPS := $(OBJS:.o=.d)`表示将$(OBJ)中的.o替换为.d  
3. 使用`-include $(DEPS)`指令将.d文件在此展开  

#### 3. 制作与使用静态链接库
```PowerShell
//以eval.o为例
//制作
ar rcs libeval.a eval.o

//使用
gcc -o 目标 main.o -L. -leval
```